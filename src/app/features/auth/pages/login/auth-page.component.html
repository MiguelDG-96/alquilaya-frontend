<!-- Contenedor Principal -->
<div class="flex items-center justify-center min-h-screen p-4 bg-gray-50">
  <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full overflow-hidden my-8">
    <div class="grid grid-cols-1 lg:grid-cols-2">
      
      <!-- Lado Izquierdo (Branding) -->
      <div class="hidden lg:flex flex-col justify-center p-12 text-white relative overflow-hidden" 
           style="background: linear-gradient(135deg, #662380 0%, #8B4FA8 100%)">
        <div class="relative z-10">
          <div class="flex items-end gap-2 mb-8">
            <figure>
              <img src="/img/logo-auth-alquilaYa.svg" alt="Logo Alquila Ya!" class="h-10 w-auto">
            </figure>
          </div>

          <h2 class="text-3xl mb-4">
            {{ isLogin() ? '¡Bienvenido de nuevo!' : '¡Únete a nosotros!' }}
          </h2>
          <p class="text-purple-100 text-lg mb-8">
            {{ isLogin()
              ? 'Accede a miles de productos disponibles para alquilar'
              : 'Comienza a alquilar o publica tus propios productos'
            }}
          </p>

          <div class="space-y-4">
            @for (benefit of [
              '100% Seguro y Verificado', 
              'Miles de productos disponibles', 
              'Proceso rápido y fácil'
            ]; track benefit) {
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-white bg-opacity-20 flex items-center justify-center text-xl">
                  ✔
                </div>
                <span>{{ benefit }}</span>
              </div>
            }
          </div>
        </div>
      </div>

      <!-- Lado Derecho (Formulario) -->
      <div class="p-8 lg:p-12 relative">
        
        <!-- Logo Móvil -->
        <div class="lg:hidden flex items-center justify-center gap-1.5 mb-6">
          <figure class="flex items-center justify-center">
            <img src="/img/logo-alquilaYa.svg" alt="Logo Alquila Ya!" class="h-12 w-auto">
          </figure>
        </div>

        <!-- Título -->
        <h3 class="text-2xl mb-2 text-gray-800">
          {{ isLogin() ? 'Iniciar Sesión' : 'Crear Cuenta' }}
        </h3>
        <p class="text-gray-600 mb-6">
          {{ isLogin()
            ? 'Ingresa tus credenciales para continuar'
            : 'Completa tus datos para registrarte'
          }}
        </p>
        
        <!-- Mensaje de Error -->
        @if (errorMessage()) {
          <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-6" role="alert">
            <span class="block">{{ errorMessage() }}</span>
          </div>
        }

        <!-- Google Login -->
        <div class="mb-6">
          <div id="g_id_onload"
               data-client_id="430705636704-i9t93p9j0s60135ec6pq665a8qlepeoa.apps.googleusercontent.com"
               data-callback="handleGoogleLogin"
               data-auto_prompt="false">
          </div>
          <div class="g_id_signin" 
               data-type="standard" 
               data-theme="outline" 
               data-text="continue_with" 
               data-shape="rectangular" 
               data-logo_alignment="left"
               data-width="100%">
          </div>
        </div>

        <!-- Separador -->
        <div class="relative mb-6">
          <div class="absolute inset-0 flex items-center">
            <div class="w-full border-t border-gray-300"></div>
          </div>
          <div class="relative flex justify-center text-sm">
            <span class="px-2 bg-white text-gray-500">o</span>
          </div>
        </div>

        <!-- Formulario -->
        <form [formGroup]="authForm" (ngSubmit)="onSubmit()" class="space-y-4">
          
          <!-- Campos de Registro -->
          @if (!isLogin()) {
            <!-- Nombre completo -->
            <div>
              <label [for]="inputIds.name" class="block text-sm mb-2 text-gray-700">
                Nombre completo
              </label>
              <app-input 
                [id]="inputIds.name"
                formControlName="registerName" 
                type="text" 
                placeholder="Juan Pérez" 
                iconLeft="fas fa-user">
              </app-input>
              @if (authForm.get('registerName')?.touched && authForm.get('registerName')?.hasError('required')) {
                <p class="text-xs text-red-500 mt-1">El nombre es obligatorio.</p>
              }
            </div>

            <!-- Celular -->
            <div>
              <label [for]="inputIds.phone" class="block text-sm mb-2 text-gray-700">
                Celular
              </label>
              <app-input 
                [id]="inputIds.phone"
                formControlName="registerPhone" 
                type="tel" 
                placeholder="987654321" 
                iconLeft="fas fa-phone">
              </app-input>
              @if (authForm.get('registerPhone')?.touched) {
                @if (authForm.get('registerPhone')?.hasError('required')) {
                  <p class="text-xs text-red-500 mt-1">El celular es obligatorio.</p>
                } @else if (authForm.get('registerPhone')?.hasError('pattern')) {
                  <p class="text-xs text-red-500 mt-1">Ingresa un celular válido (9 dígitos).</p>
                }
              }
            </div>
          }

          <!-- Email -->
          <div>
            <label [for]="inputIds.email" class="block text-sm mb-2 text-gray-700">
              Correo electrónico
            </label>
            <app-input 
              [id]="inputIds.email"
              formControlName="email" 
              type="email" 
              placeholder="tu@email.com" 
              iconLeft="fas fa-envelope">
            </app-input>
            @if (authForm.get('email')?.touched && authForm.get('email')?.invalid) {
              <p class="text-xs text-red-500 mt-1">Ingresa un correo válido.</p>
            }
          </div>

          <!-- Password -->
          <div>
            <label [for]="inputIds.password" class="block text-sm mb-2 text-gray-700">
              Contraseña
            </label>
            <app-input 
              [id]="inputIds.password"
              formControlName="password" 
              type="password" 
              placeholder="••••••••" 
              iconLeft="fas fa-lock">
            </app-input>
            @if (authForm.get('password')?.touched) {
              @if (authForm.get('password')?.hasError('required')) {
                <p class="text-xs text-red-500 mt-1">La contraseña es obligatoria.</p>
              } @else if (authForm.get('password')?.hasError('minlength')) {
                <p class="text-xs text-red-500 mt-1">La contraseña debe tener al menos 6 caracteres.</p>
              }
            }
          </div>

          <!-- Confirmar Password (solo registro) -->
          @if (!isLogin()) {
            <div>
              <label [for]="inputIds.confirmPassword" class="block text-sm mb-2 text-gray-700">
                Confirmar contraseña
              </label>
              <app-input 
                [id]="inputIds.confirmPassword"
                formControlName="registerConfirmPassword" 
                type="password" 
                placeholder="••••••••" 
                iconLeft="fas fa-lock">
              </app-input>
              @if (authForm.get('registerConfirmPassword')?.touched) {
                @if (authForm.hasError('passwordsNotMatching')) {
                  <p class="text-xs text-red-500 mt-1">Las contraseñas no coinciden.</p>
                } @else if (authForm.get('registerConfirmPassword')?.hasError('required')) {
                  <p class="text-xs text-red-500 mt-1">Debes confirmar la contraseña.</p>
                }
              }
            </div>
          }

          <!-- Opciones -->
          @if (isLogin()) {
            <!-- Recordarme y Olvidé Contraseña -->
            <div class="flex items-center justify-between">
              <label class="flex items-center">
                <input 
                  [id]="inputIds.rememberMe"
                  type="checkbox" 
                  formControlName="rememberMe" 
                  class="mr-2 h-4 w-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500" />
                <span class="text-sm text-gray-600">Recordarme</span>
              </label>
              <button 
                type="button" 
                (click)="onForgotPassword()"
                class="text-sm hover:underline font-medium" 
                style="color: #662380">
                ¿Olvidaste tu contraseña?
              </button>
            </div>
          } @else {
            <!-- Términos y Condiciones -->
            <label class="flex items-start">
              <input 
                [id]="inputIds.acceptTerms"
                type="checkbox" 
                formControlName="acceptTerms" 
                class="mt-1 mr-2 h-4 w-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500" />
              <span class="text-sm text-gray-600">
                Acepto los 
                <button type="button" class="hover:underline" style="color: #662380">Términos y Condiciones</button> 
                y la 
                <button type="button" class="hover:underline" style="color: #662380">Política de Privacidad</button>
              </span>
            </label>
            @if (authForm.get('acceptTerms')?.touched && authForm.get('acceptTerms')?.hasError('requiredTrue')) {
              <p class="text-xs text-red-500 mt-1">Debes aceptar los términos y condiciones.</p>
            }
          }

          <!-- Botón de Envío -->
          <button
            type="submit"
            [disabled]="authForm.invalid || loading()"
            class="w-full py-3 rounded-lg text-white text-lg font-semibold transition-all duration-200 shadow-lg flex items-center justify-center gap-2"
            [ngClass]="{
              'bg-gray-400 cursor-not-allowed': authForm.invalid || loading(),
              'hover:opacity-90': !authForm.invalid && !loading()
            }"
            style="background: #662380"
          >
            @if (loading()) {
              <i class="fa-solid fa-spinner fa-spin"></i>
              <span>Cargando...</span>
            } @else {
              <span>{{ isLogin() ? 'Iniciar Sesión' : 'Crear Cuenta' }}</span>
            }
          </button>
        </form>

        <!-- Footer -->
        <div class="mt-6 text-center">
          <span class="text-gray-600">
            {{ isLogin() ? '¿No tienes cuenta?' : '¿Ya tienes cuenta?' }}
          </span>
          <button
            (click)="toggleAuthMode(!isLogin())"
            class="hover:underline font-semibold ml-1"
            style="color: #662380"
          >
            {{ isLogin() ? 'Regístrate' : 'Inicia sesión' }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- MODAL DE VERIFICACIÓN DE EMAIL -->
<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
     [class.hidden]="!showVerificationModal()">
  <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-8">
    
    <!-- Encabezado del Modal -->
    <div class="text-center mb-6">
      <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
        <i class="fas fa-envelope text-purple-600 text-2xl"></i>
      </div>
      <h3 class="text-2xl font-bold text-gray-800 mb-2">Verifica tu email</h3>
      <p class="text-gray-600">
        Te enviamos un código de 6 dígitos a <span class="font-semibold">{{ verificationEmail() }}</span>
      </p>
    </div>

    <!-- Formulario de verificación -->
    <form [formGroup]="verificationForm" (ngSubmit)="onVerifySubmit()" class="space-y-6">
      
      <!-- Campo para el código -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">
          Código de verificación
        </label>
        <div class="flex justify-center space-x-2 mb-4">
          <input *ngFor="let i of [0,1,2,3,4,5]; let idx = index"
                 [id]="'verification-code-' + i + '-' + componentId"
                 type="text"
                 maxlength="1"
                 class="w-12 h-14 text-center text-2xl font-bold border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 outline-none transition-all"
                 [class.border-purple-500]="verificationForm.get('code' + i)?.touched && !verificationForm.get('code' + i)?.valid"
                 [formControlName]="'code' + i"
                 (input)="onCodeInput($event, idx)"
                 (keydown)="onCodeKeydown($event, idx)">
        </div>
        
        <!-- Mensaje de error -->
        @if (verificationForm.get('code0')?.touched && verificationForm.hasError('codeRequired')) {
          <p class="text-xs text-red-500 text-center">Ingresa el código completo</p>
        }
        
        <!-- Contador de tiempo -->
        <div class="text-center mt-4">
          <p class="text-sm text-gray-600">
            @if (resendTimer() > 0) {
              Puedes reenviar en <span class="font-semibold">{{ resendTimer() }}</span> segundos
            } @else {
              ¿No recibiste el código?
            }
          </p>
        </div>
      </div>

      <!-- Botones -->
      <div class="space-y-3">
        <button type="submit"
                [disabled]="verificationForm.invalid || verifying()"
                class="w-full py-3 bg-purple-600 hover:bg-purple-700 text-white font-semibold rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2">
          @if (verifying()) {
            <i class="fas fa-spinner fa-spin"></i>
            <span>Verificando...</span>
          } @else {
            <i class="fas fa-check-circle"></i>
            <span>Verificar y continuar</span>
          }
        </button>

        <button type="button"
                [disabled]="resendTimer() > 0 || resending()"
                (click)="onResendCode()"
                class="w-full py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2">
          @if (resending()) {
            <i class="fas fa-spinner fa-spin"></i>
            <span>Reenviando...</span>
          } @else {
            <i class="fas fa-redo"></i>
            <span>Reenviar código</span>
          }
        </button>

        <button type="button"
                (click)="closeVerificationModal()"
                class="w-full py-3 text-gray-600 hover:text-gray-800 font-medium rounded-lg transition-all">
          Cambiar correo
        </button>
      </div>
    </form>

    <!-- Mensaje de ayuda -->
    <div class="mt-6 p-4 bg-blue-50 rounded-lg">
      <p class="text-sm text-blue-700">
        <i class="fas fa-info-circle mr-2"></i>
        Revisa tu carpeta de spam si no encuentras el correo. El código expira en 10 minutos.
      </p>
    </div>
  </div>
</div>